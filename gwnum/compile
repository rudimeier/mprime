# Assembler command lines, without and with listings
#
# objconv comes courtesy of Agner Fog.  Download available at
# http://www.agner.org/optimize/#objconv

masm=ml /c /coff
#masm=ml /c /coff /Fl /Sf /Sa

# Use the MSVC 8 C compiler

cl=cl /GF /W3 /MT /D_CRT_SECURE_NO_DEPRECATE /O2 /c
cld=cl /GF /W3 /MT /D_CRT_SECURE_NO_DEPRECATE /DGDEBUG /Z7 /c
cldo=cl /GF /W3 /MT /D_CRT_SECURE_NO_DEPRECATE /DGDEBUG /Z7 /O2 /c
objconv=c:\objconv\objconv

# List of all buildables in this makefile

all:	gwnum.lib gwnumd.lib linux\gwnum.a macosx\gwnum.a release\ecmstag1.obj debug\ecmstag1.obj

# Make libraries out of the object files

gwnum.lib: release\cpuid.obj release\gwnum.obj release\gwthread.obj release\gwutil.obj release\gwdbldbl.obj release\giants.obj mult.obj multutil.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj mult2a.obj mult2aux.obj mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj xmult1.obj xmult1ax.obj xmult2.obj xmult2p.obj xmult2a.obj xmult2ap.obj xmult2ax.obj xmult3.obj xmult3p.obj xmult3a.obj xmult3ap.obj xmult4.obj xmult4p.obj xmult5.obj xmult5p.obj xmult6.obj xmult6p.obj timeit.obj timeitp.obj
    del gwnum.lib
    lib /OUT:gwnum.lib release\*.obj *.obj

gwnumd.lib: debug\cpuid.obj debug\gwnum.obj debug\gwthread.obj debug\gwutil.obj debug\gwdbldbl.obj debug\giants.obj mult.obj multutil.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj mult2a.obj mult2aux.obj mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj xmult1.obj xmult1ax.obj xmult2.obj xmult2p.obj xmult2a.obj xmult2ap.obj xmult2ax.obj xmult3.obj xmult3p.obj xmult3a.obj xmult3ap.obj xmult4.obj xmult4p.obj xmult5.obj xmult5p.obj xmult6.obj xmult6p.obj timeit.obj timeitp.obj
    del gwnumd.lib
    lib /OUT:gwnumd.lib debug\*.obj *.obj

linux\gwnum.a: mult.obj multutil.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj mult2a.obj mult2aux.obj mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj xmult1.obj xmult1ax.obj xmult2.obj xmult2p.obj xmult2a.obj xmult2ap.obj xmult2ax.obj xmult3.obj xmult3p.obj xmult3a.obj xmult3ap.obj xmult4.obj xmult4p.obj xmult5.obj xmult5p.obj xmult6.obj xmult6p.obj timeit.obj timeitp.obj
    attrib -r linux\gwnum.a
    del linux\gwnum.a
    del linux\gwnum.lib
    lib /OUT:linux\gwnum.lib *.obj
    $(objconv) -felf32 linux\gwnum.lib linux\gwnum.a
    attrib -r linux\gwnum.a
    del linux\gwnum.lib

macosx\gwnum.a: mult.obj multutil.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj mult2a.obj mult2aux.obj mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj xmult1.obj xmult1ax.obj xmult2.obj xmult2p.obj xmult2a.obj xmult2ap.obj xmult2ax.obj xmult3.obj xmult3p.obj xmult3a.obj xmult3ap.obj xmult4.obj xmult4p.obj xmult5.obj xmult5p.obj xmult6.obj xmult6p.obj timeit.obj timeitp.obj
    attrib -r macosx\gwnum.a
    del macosx\gwnum.a
    del macosx\gwnum.lib
    lib /OUT:macosx\gwnum.lib *.obj
    $(objconv) -fmacho32 -wd1050 macosx\gwnum.lib macosx\gwnum.a
    attrib -r macosx\gwnum.a
    del macosx\gwnum.lib

# Compile C code

release\cpuid.obj: cpuid.c cpuid.h
    $(cl) /Forelease\cpuid.obj cpuid.c

debug\cpuid.obj: cpuid.c cpuid.h
    $(cld) /Fodebug\cpuid.obj cpuid.c

release\gwnum.obj: gwnum.c gwnum.h
    $(cl) /Forelease\gwnum.obj gwnum.c

debug\gwnum.obj: gwnum.c gwnum.h
    $(cld) /Fodebug\gwnum.obj gwnum.c

release\gwthread.obj: gwthread.c gwthread.h
    $(cl) /Forelease\gwthread.obj gwthread.c

debug\gwthread.obj: gwthread.c gwthread.h
    $(cld) /Fodebug\gwthread.obj gwthread.c

release\gwutil.obj: gwutil.c gwutil.h
    $(cl) /Forelease\gwutil.obj gwutil.c

debug\gwutil.obj: gwutil.c gwutil.h
    $(cld) /Fodebug\gwutil.obj gwutil.c

release\gwdbldbl.obj: gwdbldbl.cpp gwdbldbl.h
    $(cl) /I..\qd /Forelease\gwdbldbl.obj gwdbldbl.cpp

debug\gwdbldbl.obj: gwdbldbl.cpp gwdbldbl.h
    $(cldo) /I..\qd /Fodebug\gwdbldbl.obj gwdbldbl.cpp

release\giants.obj: giants.c giants.h
    $(cl) /Forelease\giants.obj giants.c

debug\giants.obj: giants.c giants.h
    $(cldo) /Fodebug\giants.obj giants.c

release\ecmstag1.obj: ecmstag1.c gwnum.h
    $(cl) /Forelease\ecmstag1.obj ecmstag1.c

debug\ecmstag1.obj: ecmstag1.c gwnum.h
    $(cld) /Fodebug\ecmstag1.obj ecmstag1.c

# Create 32-bit object files

mult.obj: mult.asm
    $(masm) /DPPRO mult.asm

multutil.obj: multutil.asm
    $(masm) /DPPRO multutil.asm

mult1.obj: mult1.asm mult.mac fft1.mac lucas.mac
    $(masm) /DPPRO mult1.asm

mult1aux.obj: mult1aux.asm mult.mac normal.mac
    $(masm) mult1aux.asm

mult2.obj: mult2.asm mult.mac fft2.mac lucas.mac
    $(masm) /DPPRO mult2.asm

mult2p.obj: mult2.asm mult.mac fft2.mac lucas.mac
    $(masm) /DPPRO /DPFETCH /Fomult2p.obj mult2.asm

mult2a.obj: mult2a.asm mult.mac normal.mac
    $(masm) mult2a.asm

mult2aux.obj: mult2aux.asm mult.mac normal.mac
    $(masm) mult2aux.asm

mult3.obj: mult3.asm mult.mac fft3.mac lucas.mac
    $(masm) /DPPRO mult3.asm

mult3p.obj: mult3.asm mult.mac fft3.mac lucas.mac
    $(masm) /DPPRO /DPFETCH /Fomult3p.obj mult3.asm

mult3a.obj: mult3a.asm mult.mac pass2.mac lucas.mac
    $(masm) /DPPRO mult3a.asm

mult3ap.obj: mult3a.asm mult.mac pass2.mac lucas.mac
    $(masm) /DPPRO /DPFETCH /Fomult3ap.obj mult3a.asm

mult4.obj: mult4.asm mult.mac fft4.mac lucas.mac
    $(masm) /DPPRO mult4.asm

mult4p.obj: mult4.asm mult.mac fft4.mac lucas.mac
    $(masm) /DPPRO /DPFETCH /Fomult4p.obj mult4.asm

gianthlp.obj: gianthlp.asm
    $(masm) gianthlp.asm

cpuidhlp.obj: cpuidhlp.asm
    $(masm) cpuidhlp.asm

xmult1.obj: xmult1.asm xmult.mac xlucas.mac xfft1.mac
    $(masm) xmult1.asm

xmult1ax.obj: xmult1ax.asm xmult.mac xnormal.mac
    $(masm) xmult1ax.asm

xmult2.obj: xmult2.asm xmult.mac xlucas.mac xfft2.mac xnormal.mac
    $(masm) xmult2.asm

xmult2p.obj: xmult2.asm xmult.mac xlucas.mac xfft2.mac xnormal.mac
    $(masm) /DAMD /Foxmult2p.obj xmult2.asm

xmult2a.obj: xmult2a.asm xmult.mac xlucas.mac xnormal.mac
    $(masm) xmult2a.asm

xmult2ap.obj: xmult2a.asm xmult.mac xlucas.mac xnormal.mac
    $(masm) /DAMD /Foxmult2ap.obj xmult2a.asm

xmult2ax.obj: xmult2ax.asm xmult.mac xnormal.mac
    $(masm) xmult2ax.asm

xmult3.obj: xmult3.asm xmult.mac xlucas.mac xfft3.mac
    $(masm) xmult3.asm

xmult3p.obj: xmult3.asm xmult.mac xlucas.mac xfft3.mac
    $(masm) /DAMD /Foxmult3p.obj xmult3.asm

xmult3a.obj: xmult3a.asm xmult.mac xpass2.mac xlucas.mac
    $(masm) xmult3a.asm

xmult3ap.obj: xmult3a.asm xmult.mac xpass2.mac xlucas.mac
    $(masm) /DAMD /Foxmult3ap.obj xmult3a.asm

xmult4.obj: xmult4.asm xmult.mac xlucas.mac xfft4.mac
    $(masm) xmult4.asm

xmult4p.obj: xmult4.asm xmult.mac xlucas.mac xfft4.mac
    $(masm) /DAMD /Foxmult4p.obj xmult4.asm

xmult5.obj: xmult5.asm xmult.mac xlucas.mac xfft5.mac
    $(masm) xmult5.asm

xmult5p.obj: xmult5.asm xmult.mac xlucas.mac xfft5.mac
    $(masm) /DAMD /Foxmult5p.obj xmult5.asm

xmult6.obj: xmult6.asm xmult.mac xlucas.mac xfft6.mac
    $(masm) xmult6.asm

xmult6p.obj: xmult6.asm xmult.mac xlucas.mac xfft6.mac
    $(masm) /DAMD /Foxmult6p.obj xmult6.asm

timeit.obj: timeit.asm mult.mac lucas.mac xmult.mac xlucas.mac
    $(masm) timeit.asm

timeitp.obj: timeit.asm xmult.mac xlucas.mac
    $(masm) /DAMD /Fotimeitp.obj timeit.asm

